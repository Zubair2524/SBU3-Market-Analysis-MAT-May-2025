<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharma Dashboard - MAT May 2025</title>
    <!-- Including necessary libraries for React, Recharts, and data parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
    <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.15.0/Recharts.min.js"></script>
    <style>
        /* Glassmorphic styles */
        body {
            background: linear-gradient(135deg, #4b0082, #1e3a8a);
            color: #ffffff;
            font-family: 'Inter', Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .glassmorphic {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 20px;
            transition: all 0.3s ease;
        }
        .glassmorphic:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 40px rgba(0, 0, 0, 0.2);
        }
        button {
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            color: #1e1e1e;
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        button:hover {
            transform: scale(1.05);
        }
        select {
            background: rgba(255, 255, 255, 0.1);
            color: #ef4444; /* Red text for dropdowns */
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        select:focus {
            outline: none;
            border-color: #ffd700;
        }
        option {
            color: #ef4444; /* Red text for dropdown options */
            background: #1e1e1e;
        }
        .chart-container {
            width: 100%;
            height: 300px;
            margin-bottom: 24px;
        }
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 24px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        th {
            background: rgba(255, 255, 255, 0.15);
            position: sticky;
            top: 0;
        }
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 24px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
        }
        @media (min-width: 1024px) {
            .grid-2 {
                grid-template-columns: 1fr 1fr;
            }
        }
        .flex {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            justify-content: center;
            margin-bottom: 24px;
        }
        .text-center {
            text-align: center;
        }
        .text-lg {
            font-size: 18px;
            font-weight: 600;
        }
        .text-2xl {
            font-size: 24px;
            font-weight: bold;
        }
        .text-3xl {
            font-size: 30px;
            font-weight: bold;
        }
        .mb-2 {
            margin-bottom: 8px;
        }
        .mb-6 {
            margin-bottom: 24px;
        }
        .p-4 {
            padding: 16px;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }
        ::-webkit-scrollbar-thumb {
            background: #ffd700;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Setting up React and Recharts components
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;
        const {
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer,
            PieChart, Pie, Cell, AreaChart, Area
        } = Recharts;

        // Defining color palette
        const COLORS = ['#ffd700', '#ffaa00', '#8b5cf6', '#ffffff', '#10b981', '#ef4444'];

        // Defining main Dashboard component
        const Dashboard = () => {
            // Initializing state for data and filters
            const [data, setData] = useState([]);
            const [selectedCategory, setSelectedCategory] = useState('All');
            const [selectedBrand, setSelectedBrand] = useState('All');
            const [selectedCorporate, setSelectedCorporate] = useState('All');
            const [categories, setCategories] = useState([]);
            const [brands, setBrands] = useState([]);
            const [corporates, setCorporates] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            // Fetching and parsing CSV data
            useEffect(() => {
                fetch('./data.csv')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to fetch data.csv');
                        }
                        return response.text();
                    })
                    .then(csvData => {
                        Papa.parse(csvData, {
                            header: true,
                            skipEmptyLines: true,
                            dynamicTyping: false,
                            transformHeader: header => header.trim().replace(/^"|"$/g, ''),
                            transform: (value, header) => value.trim().replace(/^"|"$/g, ''),
                            complete: (results) => {
                                const cleanedData = results.data.map(row => {
                                    const cleaned = {};
                                    Object.keys(row).forEach(key => {
                                        let value = row[key];
                                        if (typeof value === 'string') {
                                            value = value.trim();
                                            if (!isNaN(value) && value !== '') {
                                                value = parseFloat(value);
                                            }
                                        }
                                        cleaned[key.trim().replace(/^"|"$/g, '')] = value;
                                    });
                                    return cleaned;
                                }).filter(row => Object.values(row).some(val => val !== '' && val != null));
                                
                                setData(cleanedData);
                                setCategories(['All', ...new Set(cleanedData.map(row => row.Category).filter(Boolean))]);
                                setBrands(['All', ...new Set(cleanedData.map(row => row.Brands).filter(Boolean))]);
                                setCorporates(['All', ...new Set(cleanedData.map(row => row.Corporate).filter(Boolean))]);
                                setLoading(false);
                            },
                            error: (err) => {
                                console.error('Error parsing CSV:', err);
                                setError('Error parsing CSV data');
                                setLoading(false);
                            }
                        });
                    })
                    .catch(err => {
                        console.error('Error fetching CSV:', err);
                        setError('Error fetching CSV file. Please ensure the file is served over HTTP/HTTPS.');
                        setLoading(false);
                    });
            }, []);

            // Filtering data based on dropdown selections
            const filteredData = data.filter(row => {
                return (
                    (selectedCategory === 'All' || row.Category === selectedCategory) &&
                    (selectedBrand === 'All' || row.Brands === selectedBrand) &&
                    (selectedCorporate === 'All' || row.Corporate === selectedCorporate)
                );
            });

            // Aggregating data for charts (Top 10 by key)
            const aggregateTop10 = (data, groupKey, valueKey1, valueKey2 = null) => {
                const grouped = {};
                data.forEach(row => {
                    const keyValue = row[groupKey] || 'Unknown';
                    if (!grouped[keyValue]) {
                        grouped[keyValue] = { value1: 0, value2: 0, count: 0 };
                    }
                    grouped[keyValue].value1 += parseFloat(row[valueKey1]) || 0;
                    if (valueKey2) {
                        grouped[keyValue].value2 += parseFloat(row[valueKey2]) || 0;
                    }
                    grouped[keyValue].count += 1;
                });
                const aggregated = Object.keys(grouped).map(key => ({
                    name: key,
                    value1: grouped[key].value1 / grouped[key].count,
                    value2: valueKey2 ? grouped[key].value2 / grouped[key].count : 0
                }));
                return aggregated.sort((a, b) => b.value1 - a.value1).slice(0, 10);
            };

            // Preparing data for charts
            const top10CorporatesValue = aggregateTop10(filteredData, 'Corporate', 'Value 25', 'Value 24');
            const top10CorporatesUnit = aggregateTop10(filteredData, 'Corporate', 'Unit 25', 'Unit 24');
            const top10BrandsValue = aggregateTop10(filteredData, 'Brands', 'Value 25', 'Value 24');
            const top10BrandsUnit = aggregateTop10(filteredData, 'Brands', 'Unit 25', 'Unit 24');
            const top10CategoriesValue = aggregateTop10(filteredData, 'Category', 'Value 25', 'Value 24');
            const top10CategoriesUnit = aggregateTop10(filteredData, 'Category', 'Unit 25', 'Unit 24');
            const top10CorporatesShare = aggregateTop10(filteredData, 'Corporate', 'Share 25');
            const top10CategoriesGrowth = aggregateTop10(filteredData, 'Category', 'Growth Value 25');

            // Calculating top performers for table
            const topPerformers = filteredData
                .sort((a, b) => (parseFloat(b['Value 25']) || 0) - (parseFloat(a['Value 25']) || 0))
                .slice(0, 5);

            // Formatting numbers for display
            const formatNumber = (num) => {
                if (isNaN(num)) return '0';
                if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
                if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
                if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
                return num.toFixed(0);
            };

            // Rendering error state
            if (error) {
                return <div className="text-center text-2xl">{error}</div>;
            }

            // Rendering loading state
            if (loading) {
                return <div className="text-center text-2xl">Loading...</div>;
            }

            // Rendering main dashboard
            return (
                <div className="container">
                    <h1 className="text-3xl mb-6 text-center">Pharma Market Analysis - MAT May 2025</h1>
                    
                    {/* Dropdown filters */}
                    <div className="flex">
                        <div>
                            <label className="mr-2">Category:</label>
                            <select
                                value={selectedCategory}
                                onChange={(e) => setSelectedCategory(e.target.value)}
                            >
                                {categories.map(category => (
                                    <option key={category} value={category}>{category}</option>
                                ))}
                            </select>
                        </div>
                        <div>
                            <label className="mr-2">Brand:</label>
                            <select
                                value={selectedBrand}
                                onChange={(e) => setSelectedBrand(e.target.value)}
                            >
                                {brands.map(brand => (
                                    <option key={brand} value={brand}>{brand}</option>
                                ))}
                            </select>
                        </div>
                        <div>
                            <label className="mr-2">Corporate:</label>
                            <select
                                value={selectedCorporate}
                                onChange={(e) => setSelectedCorporate(e.target.value)}
                            >
                                {corporates.map(corporate => (
                                    <option key={corporate} value={corporate}>{corporate}</option>
                                ))}
                            </select>
                        </div>
                    </div>

                    {/* Summary section */}
                    <div className="grid">
                        <div className="glassmorphic p-4">
                            <h2 className="text-lg mb-2">Total Value (2025)</h2>
                            <p className="text-2xl">{formatNumber(filteredData.reduce((sum, row) => sum + (parseFloat(row['Value 25']) || 0), 0))}</p>
                        </div>
                        <div className="glassmorphic p-4">
                            <h2 className="text-lg mb-2">Total Units (2025)</h2>
                            <p className="text-2xl">{formatNumber(filteredData.reduce((sum, row) => sum + (parseFloat(row['Unit 25']) || 0), 0))}</p>
                        </div>
                        <div className="glassmorphic p-4">
                            <h2 className="text-lg mb-2">Average Share (2025)</h2>
                            <p className="text-2xl">{(filteredData.reduce((sum, row) => sum + (parseFloat(row['Share 25']) || 0), 0) / (filteredData.length || 1)).toFixed(2)}%</p>
                        </div>
                        <div className="glassmorphic p-4">
                            <h2 className="text-lg mb-2">Average Growth (2025)</h2>
                            <p className="text-2xl">{(filteredData.reduce((sum, row) => sum + (parseFloat(row['Growth Value 25']) || 0), 0) / (filteredData.length || 1)).toFixed(2)}%</p>
                        </div>
                    </div>

                    {/* Charts section */}
                    <div className="grid-2">
                        {/* Top 10 Corporates (Value 25 vs Value 24) */}
                        <div className="glassmorphic chart-container">
                            <h2 className="text-lg mb-2">Top 10 Corporates (Value 2025 vs 2024)</h2>
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={top10CorporatesValue}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="rgba(255, 255, 255, 0.3)" />
                                    <XAxis dataKey="name" stroke="#ffffff" fontSize={12} />
                                    <YAxis stroke="#ffffff" fontSize={12} tickFormatter={formatNumber} />
                                    <Tooltip formatter={formatNumber} contentStyle={{ background: 'rgba(255, 255, 255, 0.1)', border: 'none', borderRadius: '8px' }} />
                                    <Legend />
                                    <Bar dataKey="value1" name="Value 2025" fill="#ffd700" />
                                    <Bar dataKey="value2" name="Value 2024" fill="#8b5cf6" />
                                </BarChart>
                            </ResponsiveContainer>
                        </div>

                        {/* Top 10 Corporates (Unit 25 vs Unit 24) */}
                        <div className="glassmorphic chart-container">
                            <h2 className="text-lg mb-2">Top 10 Corporates (Unit 2025 vs 2024)</h2>
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={top10CorporatesUnit}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="rgba(255, 255, 255, 0.3)" />
                                    <XAxis dataKey="name" stroke="#ffffff" fontSize={12} />
                                    <YAxis stroke="#ffffff" fontSize={12} tickFormatter={formatNumber} />
                                    <Tooltip formatter={formatNumber} contentStyle={{ background: 'rgba(255, 255, 255, 0.1)', border: 'none', borderRadius: '8px' }} />
                                    <Legend />
                                    <Bar dataKey="value1" name="Unit 2025" fill="#ffd700" />
                                    <Bar dataKey="value2" name="Unit 2024" fill="#8b5cf6" />
                                </BarChart>
                            </ResponsiveContainer>
                        </div>

                        {/* Top 10 Brands (Value 25 vs Value 24) */}
                        <div className="glassmorphic chart-container">
                            <h2 className="text-lg mb-2">Top 10 Brands (Value 2025 vs 2024)</h2>
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={top10BrandsValue}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="rgba(255, 255, 255, 0.3)" />
                                    <XAxis dataKey="name" stroke="#ffffff" fontSize={12} />
                                    <YAxis stroke="#ffffff" fontSize={12} tickFormatter={formatNumber} />
                                    <Tooltip formatter={formatNumber} contentStyle={{ background: 'rgba(255, 255, 255, 0.1)', border: 'none', borderRadius: '8px' }} />
                                    <Legend />
                                    <Bar dataKey="value1" name="Value 2025" fill="#ffd700" />
                                    <Bar dataKey="value2" name="Value 2024" fill="#8b5cf6" />
                                </BarChart>
                            </ResponsiveContainer>
                        </div>

                        {/* Top 10 Brands (Unit 25 vs Unit 24) */}
                        <div className="glassmorphic chart-container">
                            <h2 className="text-lg mb-2">Top 10 Brands (Unit 2025 vs 2024)</h2>
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={top10BrandsUnit}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="rgba(255, 255, 255, 0.3)" />
                                    <XAxis dataKey="name" stroke="#ffffff" fontSize={12} />
                                    <YAxis stroke="#ffffff" fontSize={12} tickFormatter={formatNumber} />
                                    <Tooltip formatter={formatNumber} contentStyle={{ background: 'rgba(255, 255, 255, 0.1)', border: 'none', borderRadius: '8px' }} />
                                    <Legend />
                                    <Bar dataKey="value1" name="Unit 2025" fill="#ffd700" />
                                    <Bar dataKey="value2" name="Unit 2024" fill="#8b5cf6" />
                                </BarChart>
                            </ResponsiveContainer>
                        </div>

                        {/* Top 10 Categories (Value 25 vs Value 24) */}
                        <div className="glassmorphic chart-container">
                            <h2 className="text-lg mb-2">Top 10 Categories (Value 2025 vs 2024)</h2>
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={top10CategoriesValue}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="rgba(255, 255, 255, 0.3)" />
                                    <XAxis dataKey="name" stroke="#ffffff" fontSize={12} />
                                    <YAxis stroke="#ffffff" fontSize={12} tickFormatter={formatNumber} />
                                    <Tooltip formatter={formatNumber} contentStyle={{ background: 'rgba(255, 255, 255, 0.1)', border: 'none', borderRadius: '8px' }} />
                                    <Legend />
                                    <Bar dataKey="value1" name="Value 2025" fill="#ffd700" />
                                    <Bar dataKey="value2" name="Value 2024" fill="#8b5cf6" />
                                </BarChart>
                            </ResponsiveContainer>
                        </div>

                        {/* Top 10 Categories (Unit 25 vs Unit 24) */}
                        <div className="glassmorphic chart-container">
                            <h2 className="text-lg mb-2">Top 10 Categories (Unit 2025 vs 2024)</h2>
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={top10CategoriesUnit}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="rgba(255, 255, 255, 0.3)" />
                                    <XAxis dataKey="name" stroke="#ffffff" fontSize={12} />
                                    <YAxis stroke="#ffffff" fontSize={12} tickFormatter={formatNumber} />
                                    <Tooltip formatter={formatNumber} contentStyle={{ background: 'rgba(255, 255, 255, 0.1)', border: 'none', borderRadius: '8px' }} />
                                    <Legend />
                                    <Bar dataKey="value1" name="Unit 2025" fill="#ffd700" />
                                    <Bar dataKey="value2" name="Unit 2024" fill="#8b5cf6" />
                                </BarChart>
                            </ResponsiveContainer>
                        </div>

                        {/* Pie Chart for Market Share by Top 10 Corporates */}
                        <div className="glassmorphic chart-container">
                            <h2 className="text-lg mb-2">Market Share by Top 10 Corporates (2025)</h2>
                            <ResponsiveContainer width="100%" height="100%">
                                <PieChart>
                                    <Pie
                                        data={top10CorporatesShare}
                                        dataKey="value1"
                                        nameKey="name"
                                        cx="50%"
                                        cy="50%"
                                        outerRadius={80}
                                        label={({ name, percent }) => `${name} (${(percent * 100).toFixed(1)}%)`}
                                        labelLine={false}
                                    >
                                        {top10CorporatesShare.map((entry, index) => (
                                            <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                                        ))}
                                    </Pie>
                                    <Tooltip formatter={value => `${value.toFixed(2)}%`} contentStyle={{ background: 'rgba(255, 255, 255, 0.1)', border: 'none', borderRadius: '8px' }} />
                                    <Legend />
                                </PieChart>
                            </ResponsiveContainer>
                        </div>

                        {/* Area Chart for Growth by Top 10 Categories */}
                        <div className="glassmorphic chart-container">
                            <h2 className="text-lg mb-2">Growth Value by Top 10 Categories (2025)</h2>
                            <ResponsiveContainer width="100%" height="100%">
                                <AreaChart data={top10CategoriesGrowth}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="rgba(255, 255, 255, 0.3)" />
                                    <XAxis dataKey="name" stroke="#ffffff" fontSize={12} />
                                    <YAxis stroke="#ffffff" fontSize={12} tickFormatter={value => `${value.toFixed(1)}%`} />
                                    <Tooltip formatter={value => `${value.toFixed(2)}%`} contentStyle={{ background: 'rgba(255, 255, 255, 0.1)', border: 'none', borderRadius: '8px' }} />
                                    <Legend />
                                    <Area type="monotone" dataKey="value1" name="Growth Value 2025" fill="#10b981" stroke="#10b981" fillOpacity={0.4} />
                                </AreaChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    {/* Table for top performers */}
                    <div className="glassmorphic table-container">
                        <h2 className="text-lg mb-2">Top Performers</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Brand</th>
                                    <th>Corporate</th>
                                    <th>Value 2025</th>
                                    <th>Share 2025</th>
                                    <th>Growth 2025</th>
                                    <th>Units 2025</th>
                                </tr>
                            </thead>
                            <tbody>
                                {topPerformers.map((row, index) => (
                                    <tr key={index}>
                                        <td>{row.Category || 'N/A'}</td>
                                        <td>{row.Brands || 'N/A'}</td>
                                        <td>{row.Corporate || 'N/A'}</td>
                                        <td>{formatNumber(parseFloat(row['Value 25']) || 0)}</td>
                                        <td>{(parseFloat(row['Share 25']) || 0).toFixed(2)}%</td>
                                        <td>{(parseFloat(row['Growth Value 25']) || 0).toFixed(2)}%</td>
                                        <td>{formatNumber(parseFloat(row['Unit 25']) || 0)}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {/* Interesting fact */}
                    <div className="glassmorphic p-4">
                        <h2 className="text-lg mb-2">Interesting Fact</h2>
                        <p>
                            Did you know? The highest growth in value for 2025 is observed in the PREGABALIN category, with
                            GABICA from GETZ PHARMA showing a remarkable 26.95% growth, contributing significantly to its 47.81%
                            market share in the category!
                        </p>
                    </div>
                </div>
            );
        };

        // Rendering the app
        const root = createRoot(document.getElementById('root'));
        root.render(<Dashboard />);
    </script>
</body>
</html>
